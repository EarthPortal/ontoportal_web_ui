.card.mb-4{"data-controller" => "project-creation"}
  .card-header
    %h5.mb-0= t("projects.details")
  .card-body
    -# Hidden field to store complete project data
    = hidden_field_tag :project_data, "", data: { project_creation_target: "projectData" }
    
    -# Project title (name in the response)
    .upload-ontology-input-field-container{"data-project-creation-target" => "name"}
      = render Input::TextInputComponent.new(label: label_required(t("projects.form.title")), name: "project[title]")
    
    -# Project acronym
    .upload-ontology-input-field-container{"data-project-creation-target" => "acronym"}
      = render Input::TextInputComponent.new(label: t("projects.form.acronym"), name: "project[acronym]")
    
    -# Project description
    .upload-ontology-input-field-container{"data-project-creation-target" => "description"}
      = render Input::TextAreaComponent.new(label: label_required(t("projects.form.description")), name: "project[description]", rows: 4)

    -# Project dates
    .row
      .col-md-6
        .upload-ontology-input-field-container{"data-project-creation-target" => "startDate"}
          = render Input::DateComponent.new(label: t("projects.form.start_date"), name: "project[start_date]")
      .col-md-6
        .upload-ontology-input-field-container{"data-project-creation-target" => "endDate"}
          = render Input::DateComponent.new(label: t("projects.form.end_date"), name: "project[end_date]")
    
    -# Organization (Agent)
    .upload-ontology-input-field-container{"data-project-creation-target" => "organizations"}
      = render NestedFormInputsComponent.new(object_name: t("projects.form.organization")) do |component|
        - component.with_header do
          %div
            %span= t("projects.form.organization")
            %span.text-danger *
        
        - component.with_empty_state do
          = hidden_field_tag "project[organizations_attributes][]", nil
        
        - component.with_template do
          .d-flex.flex-column{"data-controller" => "turbo-frame-error"}
            = turbo_frame_tag "project_organization_NEW_RECORD", data: { "turbo-frame-error-target": "frame", action: "turbo:before-fetch-response->turbo-frame-error#showError turbo:before-fetch-request->turbo-frame-error#hideError" } do
              .hide-if-loading
                = hidden_field_tag "project[organizations_attributes][NEW_RECORD]", nil, id: "project_organizations_attributes_NEW_RECORD"
                .search-inputs{"data-controller" => "search-input", 
                            "data-search-input-ajax-url-value" => "/ajax/agents?query=&type=organization",
                            "data-search-input-cache-value" => "false",
                            "data-search-input-id-key-value" => "id",
                            "data-search-input-item-link-base-value" => "/agents/NEW_RECORD?parent_id=project_organization&edit_on_modal=false&name_prefix=project[organizations_attributes]&deletable=false&agent_id=",
                            "data-search-input-scroll-down-value" => "true",
                            "data-search-input-selected-item-value" => "0",
                            id: "agentNEW_RECORD"}
                  
                  %a.d-none{"data-search-input-target" => "loader"}
                  %a.d-none{"data-search-input-target" => "button"}
                  %div
                    %input.input-field-component.text-input.not-disabled{
                      "data-action" => "input->search-input#search blur->search-input#blur keydown.down->search-input#arrow_down keydown.up->search-input#arrow_up keydown.enter->search-input#enter_key",
                      "data-controller" => "tooltip",
                      "data-search-input-target" => "input",
                      id: "",
                      name: "agentNEW_RECORD",
                      placeholder: t("projects.form.search_organization"),
                      type: "text",
                      value: ""
                    }

                  .search-container.search-container-scroll{"data-action" => "mousedown->search-input#prevent", "data-search-input-target" => "dropDown"}
                    %a.search-content{"data-search-input-target" => "actionLink",
                                    "data-turbo-frame" => "_self", 
                                    href: "/agents/new?name=&id=NEW_RECORD&parent_id=project_organization&type=organization&show_affiliations=true&deletable=false&edit_on_modal=false&name_prefix=project[organizations_attributes][NEW_RECORD]",
                                    id: "search-content"}
                      %p.mb-0
                      %div
                        %img{src: asset_path("loop.svg")}
                        %p= t("agents.create_new")

                  %template{"data-search-input-target" => "template"}
                    %a.search-content{"data-turbo-frame" => "_self", href: "LINK"}
                      %p.search-element.home-searched-ontology
                        NAME ACRONYM IDENTIFIERS
                      %p.home-result-type
                        TYPE
              
              .show-if-loading.my-auto.mx-auto
                .p-3
                  .loader-component
                    .lds-ellipsis.loader-component
                      %div
                      %div
                      %div
                      %div
              
              %span{"data-turbo-frame-error-target" => "errorMessage", style: "display: none; width: 100%"}
                .alert-container.alert-danger-type{"data-controller" => "alert-component", style: "white-space: normal;"}
                  .alert-icon.alert-danger-type
                    %svg.mr-3.h-5.w-5.flex-shrink-0{fill: "currentColor", viewbox: "0 0 20 20", xmlns: "http://www.w3.org/2000/svg"}
                      %path{:clip_rule => "evenodd", :d => "M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z", :fill_rule => "evenodd"}
                  .alert-message.alert-danger-type
                  .alert-close.alert-danger-type{"data-action" => "click->alert-component#close"}
                    %svg{fill: "none", height: "10", viewbox: "0 0 148 148", width: "10", xmlns: "http://www.w3.org/2000/svg"}
                      %path{:clip_rule => "evenodd", :d => "M3.09251 3.22733C5.07323 1.2455 7.75931 0.132162 10.5601 0.132162C13.3608 0.132162 16.0469 1.2455 18.0276 3.22733L73.934 59.1819L129.84 3.22733C130.815 2.21766 131.98 1.4123 133.269 0.858261C134.557 0.304223 135.943 0.0125966 137.346 0.000399146C138.748 -0.0117983 140.139 0.255675 141.437 0.787215C142.735 1.31876 143.915 2.10372 144.906 3.0963C145.898 4.08888 146.682 5.2692 147.213 6.56839C147.745 7.86758 148.012 9.25962 148 10.6633C147.987 12.067 147.696 13.4541 147.142 14.7439C146.589 16.0336 145.784 17.2001 144.775 18.1753L88.8691 74.1299L144.775 130.084C146.699 132.078 147.764 134.749 147.74 137.52C147.716 140.292 146.605 142.944 144.647 144.904C142.688 146.864 140.039 147.976 137.27 148C134.5 148.024 131.832 146.958 129.84 145.032L73.934 89.0779L18.0276 145.032C16.0355 146.958 13.3675 148.024 10.5981 148C7.82867 147.976 5.17951 146.864 3.22117 144.904C1.26283 142.944 0.151998 140.292 0.127932 137.52C0.103867 134.749 1.16849 132.078 3.09251 130.084L58.9989 74.1299L3.09251 18.1753C1.11238 16.1929 0 13.5045 0 10.7013C0 7.89817 1.11238 5.20977 3.09251 3.22733Z", :fill => "black", :fill_rule => "evenodd"}
    
    -# Contact (Person/Agents) - Keep your existing implementation that works
    .upload-ontology-input-field-container{"data-project-creation-target" => "contacts"}
      = render NestedFormInputsComponent.new(object_name: t("projects.form.contact")) do |component|
        - component.with_header do
          %div
            %span= t("projects.form.contact")
        
        - component.with_empty_state do
          = hidden_field_tag "project[contacts_attributes][]", nil
        
        - component.with_template do
          .d-flex.flex-column{"data-controller" => "turbo-frame-error"}
            = turbo_frame_tag "project_contact_NEW_RECORD", data: { "turbo-frame-error-target": "frame", action: "turbo:before-fetch-response->turbo-frame-error#showError turbo:before-fetch-request->turbo-frame-error#hideError" } do
              .hide-if-loading
                = hidden_field_tag "project[contacts_attributes][NEW_RECORD]", nil, id: "project_contacts_attributes_NEW_RECORD"
                .search-inputs{"data-controller" => "search-input", 
                            "data-search-input-ajax-url-value" => "/ajax/agents?query=",
                            "data-search-input-cache-value" => "false",
                            "data-search-input-id-key-value" => "id",
                            "data-search-input-item-link-base-value" => "/agents/NEW_RECORD?parent_id=project_contact&edit_on_modal=false&name_prefix=project[contacts_attributes]&deletable=false&agent_id=",
                            "data-search-input-scroll-down-value" => "true",
                            "data-search-input-selected-item-value" => "0",
                            id: "agentNEW_RECORD"}
                  
                  %a.d-none{"data-search-input-target" => "loader"}
                  %a.d-none{"data-search-input-target" => "button"}
                  %div
                    %input.input-field-component.text-input.not-disabled{
                      "data-action" => "input->search-input#search blur->search-input#blur keydown.down->search-input#arrow_down keydown.up->search-input#arrow_up keydown.enter->search-input#enter_key",
                      "data-controller" => "tooltip",
                      "data-search-input-target" => "input",
                      id: "",
                      name: "agentNEW_RECORD",
                      placeholder: t("projects.form.search_contact"),
                      type: "text",
                      value: ""
                    }

                  .search-container.search-container-scroll{"data-action" => "mousedown->search-input#prevent", "data-search-input-target" => "dropDown"}
                    %a.search-content{"data-search-input-target" => "actionLink",
                                    "data-turbo-frame" => "_self", 
                                    href: "/agents/new?name=&id=NEW_RECORD&parent_id=project_contact&type=&show_affiliations=true&deletable=false&edit_on_modal=false&name_prefix=project[contacts_attributes][NEW_RECORD]",
                                    id: "search-content"}
                      %p.mb-0
                      %div
                        %img{src: asset_path("loop.svg")}
                        %p= t("agents.create_new")

                  %template{"data-search-input-target" => "template"}
                    %a.search-content{"data-turbo-frame" => "_self", href: "LINK"}
                      %p.search-element.home-searched-ontology
                        NAME ACRONYM IDENTIFIERS
                      %p.home-result-type
                        TYPE
              
              .show-if-loading.my-auto.mx-auto
                .p-3
                  .loader-component
                    .lds-ellipsis.loader-component
                      %div
                      %div
                      %div
                      %div
              
              %span{"data-turbo-frame-error-target" => "errorMessage", style: "display: none; width: 100%"}
                .alert-container.alert-danger-type{"data-controller" => "alert-component", style: "white-space: normal;"}
                  .alert-icon.alert-danger-type
                    %svg.mr-3.h-5.w-5.flex-shrink-0{fill: "currentColor", viewbox: "0 0 20 20", xmlns: "http://www.w3.org/2000/svg"}
                      %path{:clip_rule => "evenodd", :d => "M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z", :fill_rule => "evenodd"}
                  .alert-message.alert-danger-type
                  .alert-close.alert-danger-type{"data-action" => "click->alert-component#close"}
                    %svg{fill: "none", height: "10", viewbox: "0 0 148 148", width: "10", xmlns: "http://www.w3.org/2000/svg"}
                      %path{:clip_rule => "evenodd", :d => "M3.09251 3.22733C5.07323 1.2455 7.75931 0.132162 10.5601 0.132162C13.3608 0.132162 16.0469 1.2455 18.0276 3.22733L73.934 59.1819L129.84 3.22733C130.815 2.21766 131.98 1.4123 133.269 0.858261C134.557 0.304223 135.943 0.0125966 137.346 0.000399146C138.748 -0.0117983 140.139 0.255675 141.437 0.787215C142.735 1.31876 143.915 2.10372 144.906 3.0963C145.898 4.08888 146.682 5.2692 147.213 6.56839C147.745 7.86758 148.012 9.25962 148 10.6633C147.987 12.067 147.696 13.4541 147.142 14.7439C146.589 16.0336 145.784 17.2001 144.775 18.1753L88.8691 74.1299L144.775 130.084C146.699 132.078 147.764 134.749 147.74 137.52C147.716 140.292 146.605 142.944 144.647 144.904C142.688 146.864 140.039 147.976 137.27 148C134.5 148.024 131.832 146.958 129.84 145.032L73.934 89.0779L18.0276 145.032C16.0355 146.958 13.3675 148.024 10.5981 148C7.82867 147.976 5.17951 146.864 3.22117 144.904C1.26283 142.944 0.151998 140.292 0.127932 137.52C0.103867 134.749 1.16849 132.078 3.09251 130.084L58.9989 74.1299L3.09251 18.1753C1.11238 16.1929 0 13.5045 0 10.7013C0 7.89817 1.11238 5.20977 3.09251 3.22733Z", :fill => "black", :fill_rule => "evenodd"}
    
    -# Homepage URL
    .upload-ontology-input-field-container{"data-project-creation-target" => "homePage"}
      = render Input::UrlComponent.new(label: t("projects.form.homepage"), name: "project[homepage]")
    
    -# Keywords
    .upload-ontology-input-field-container{"data-project-creation-target" => "keywords"}
      = render Input::TextInputComponent.new(label: t("projects.form.keywords"), name: "project[keywords]")

    -# Funding details
    .funding-details.mt-4
      .upload-ontology-section-title
        %h6= t("projects.form.funding_details")
      
      .upload-ontology-input-field-container{"data-project-creation-target" => "grantNumber"}
        = render Input::TextInputComponent.new(label: t("projects.form.grant_number"), name: "project[grant_number]")
      
      .upload-ontology-input-field-container{"data-project-creation-target" => "funder"}
        = render Input::TextInputComponent.new(label: t("projects.form.funder"), name: "project[funder]")
        
      .upload-ontology-input-field-container
        %label.form-label
          = t("projects.form.ontologies")
          %span.text-danger *
        .field.w-100
          = ontologies_selector(id: 'project_ontologies', name: 'project[ontologies][]', selected: @project&.ontologies&.map(&:acronym), ontologies: onts_for_select(include_views: true))

= turbo_frame_tag "modal"